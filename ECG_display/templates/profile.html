{% load static %}
<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Мій профіль</title>
  <meta name="description" content="Профіль користувача та прогрес у симуляторах" />
  <style>
    :root{
      --bg:#0b0f14; --fg:#eaf2ff; --muted:#a1b3c9; --brand:#6ee7ff; --accent:#a78bfa;
      --border:rgba(255,255,255,.12); --card:rgba(255,255,255,.06); --glass:rgba(255,255,255,.08);
      --shadow:0 20px 60px rgba(0,0,0,.35), 0 2px 8px rgba(0,0,0,.3);
      --ok:#21f6a1; --warn:#ffd85c; --err:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", "Helvetica Neue", Arial; color:var(--fg);
      background:
        radial-gradient(1200px 600px at 10% -10%, #18304a 0%, transparent 60%),
        radial-gradient(1000px 500px at 110% 0%, #3a1c66 0%, transparent 55%),
        radial-gradient(900px 800px at -10% 120%, #0e515f 0%, transparent 70%),
        var(--bg);
      overflow-x:hidden;
    }
    .background-anim::before{content:""; position:fixed; inset:-20% -20% -20% -20%; pointer-events:none; z-index:-1; background: conic-gradient(from 180deg at 50% 50%, rgba(110,231,255,.10), rgba(167,139,250,.10), rgba(110,231,255,.10)); filter: blur(90px); opacity:.9; animation: spin 36s linear infinite;}
    @keyframes spin{to{transform:rotate(1turn)}}

    .container{max-width:1100px; margin:0 auto; padding:0 20px}
    header{position:sticky; top:0; z-index:40; backdrop-filter:saturate(170%) blur(12px); background:rgba(11,15,20,.6); border-bottom:1px solid var(--border)}
    .nav{display:flex; align-items:center; justify-content:space-between; height:64px}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--fg); font-weight:700}
    .brand img{height:36px; width:auto}
    .nav a{color:var(--fg); text-decoration:none; opacity:.9; padding:8px 10px; border-radius:12px}
    .nav a:hover{background:var(--card); opacity:1}

    main{padding:32px 0 60px}

    /* PROFILE HEADER */
    .header{display:flex; gap:20px; align-items:center; margin-bottom:22px}
    .avatar{width:88px; height:88px; border-radius:20px; overflow:hidden; border:1px solid var(--border); background:var(--glass); box-shadow:var(--shadow)}
    .avatar img{width:100%; height:100%; object-fit:cover; display:block}
    .who{flex:1}
    .who h1{margin:0 0 4px; font-size:28px}
    .who p{margin:0; color:var(--muted)}

    /* GRID */
    .grid{display:grid; grid-template-columns: 1.2fr .8fr; gap:18px}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

    .card{background:var(--glass); border:1px solid var(--border); border-radius:22px; padding:18px; box-shadow:var(--shadow)}
    .card h2{margin:0 0 10px; font-size:20px}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .chip{padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:var(--card)}

    /* TABLE */
    table{width:100%; border-collapse:separate; border-spacing:0 8px}
    th{font-weight:600; text-align:left; font-size:14px; color:#cfe2ff; padding:6px 10px}
    td{padding:10px 10px; background:var(--card); border-top:1px solid var(--border); border-bottom:1px solid var(--border)}
    tr td:first-child{border-left:1px solid var(--border); border-top-left-radius:12px; border-bottom-left-radius:12px}
    tr td:last-child{border-right:1px solid var(--border); border-top-right-radius:12px; border-bottom-right-radius:12px}
    .muted{color:var(--muted)}

    /* ACTIONS */
    .actions{display:flex; gap:10px; flex-wrap:wrap}
    .btn{--br:linear-gradient(120deg, var(--brand), var(--accent)); display:inline-flex; align-items:center; gap:.5rem; padding:12px 16px; border-radius:14px; text-decoration:none; color:#081116; font-weight:700; letter-spacing:.3px; background:var(--br); border:0}
    .btn:hover{filter:saturate(1.12)}
    .btn-ghost{color:var(--fg); background:transparent; border:1px solid var(--border)}
    .danger{background:linear-gradient(120deg, #ff8c8c, #ff6b6b); color:#1a0f0f}

    /* SMALLS */
    .kv{display:grid; grid-template-columns:140px 1fr; gap:8px; margin:8px 0}
    .kv .k{color:#cfe2ff; font-size:14px}
    .kv .v{color:var(--fg)}
  </style>
</head>
<body class="background-anim">
  <header>
    <div class="container nav">
      <a href="{% url 'home' %}" class="brand" aria-label="Головна">
        <img src="{% static 'img/logo.png' %}" alt="Лого"/>
        <span>Анестезіо&nbsp;симулятор</span>
      </a>
      <nav>
        <a href="{% url 'home' %}">Головна</a>
        <a href="{% url 'logout' %}">Вийти</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="header">
      <div class="avatar">
        {% if user.profile and user.profile.avatar %}
          <img src="{{ user.profile.avatar.url }}" alt="Аватар {{ user.get_username }}">
        {% else %}
          <img src="{% static 'img/logo.png' %}" alt="Аватар за замовчуванням">
        {% endif %}
      </div>
      <div class="who">
        <h1>{{ user.get_full_name|default:user.get_username }}</h1>
        <p class="muted">{{ user.email }}</p>
        <div class="actions" style="margin-top:10px">
          <a class="btn" href="/simulators/">Продовжити тренування</a>
        </div>
      </div>
    </section>

    <section class="grid">
        <div class="card">
  <h2>Проплачені функції</h2>

  {% if paid_features %}
    <table aria-label="Проплачені функції">
    <p class="muted">
      
      <a class="btn" href="/billing/">Додати/змінити план</a>
    </p>
      <thead>
        <tr>
          <th>Функція</th>
          <th>План</th>
          <th>Статус</th>
          <th>Діє до</th>
        </tr>
      </thead>
      <tbody>
        {% for f in paid_features %}
        <tr>
          <td>{{ f.title }}</td>
          <td class="muted">{{ f.plan|default:"—" }}</td>
          <td>
            {% if f.active %}
              <span style="color:var(--ok)">Активно</span>
            {% else %}
              <span style="color:var(--err)">Неактивно</span>
            {% endif %}
          </td>
          <td class="muted">
            {% if f.expires_at %}{{ f.expires_at|date:"d.m.Y" }}{% else %}—{% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="muted">
      Немає активних підписок.
      <a href="/billing/">Оформити підписку</a>
    </p>
  {% endif %}
</div>

    </div>

      <!-- Права колонка: дані акаунта -->
      <aside class="card">
        <h2>Дані акаунта</h2>
        <div class="kv">
          <div class="k">Логін</div>
          <div class="v">{{ user.get_username }}</div>
          <div class="k">Email</div>
          <div class="v">{{ user.email|default:"—" }}</div>
          <div class="k">Ім'я</div>
          <div class="v">{{ user.first_name|default:"—" }}</div>
          <div class="k">Прізвище</div>
          <div class="v">{{ user.last_name|default:"—" }}</div>
          <div class="k">Зареєстрований</div>
          <div class="v">{{ user.date_joined|date:"d.m.Y H:i" }}</div>
        </div>

        <hr style="border:0; border-top:1px solid var(--border); margin:16px 0"/>
        <div class="row">
              <form action="{% url 'logout' %}" method="post" style="display:inline">
    {% csrf_token %}
                <button type="submit" class="btn btn-ghost">Вийти</button>
            </form>
        </div>
        <p class="muted" style="margin-top:10px">Після зміни пароля може знадобитись повторний вхід на пристроях.</p>
      </aside>
    </section>

    <!-- Опційно: бейджі навичок/інтересів -->
    {% if skills %}
    <section class="card" style="margin-top:18px">
      <h2>Навички / інтереси</h2>
      <div class="row">
        {% for s in skills %}<span class="chip">{{ s }}</span>{% endfor %}
      </div>
    </section>
    {% endif %}

  </main>
</body>
</html>
